<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="The building blocks of drumming are rudiments much like scales are to any melodic instrument. A simple but clean single stroke roll can make you sound like a pro.
I normally practice with a metronome but you can get more sophisticated. There are apps that provide visual feedback for every hit (&ldquo;am i lagging, rushing or on the beat?&rdquo;) so you can adjust accordingly while practicing. I decided to build my own.">  

  <title>
    
      Detecting drum hits
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  
  
  
  <link rel="stylesheet" href="//localhost:1313/css/main.221cf80b19eb66a695fc24042a35e1738e354fc76f052d24dfdc6073a0236c7d436f9b1f847bf0fa5d029fa0b67b8f9e1fe63bd6b232475142608d430572ba18.css" integrity="sha512-Ihz4CxnrZqaV/CQEKjXhc441T8dvBS0k39xgc6AjbH1Db5sfhHvw&#43;l0Cn6C2e4&#43;eH&#43;Y71rIyR1FCYI1DBXK6GA==" />
  
</head>

    <script defer src="/js/theme-toggle.min.js"></script>
    <body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
                <button
  id="theme-toggle"
  aria-label="Toggle theme"
  style="
    all: unset;
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 999;
    font-size: 1.2rem;
    line-height: 1;
    padding: 0;
    margin: 0;
    cursor: pointer;
  "
>
  ðŸŒ“
</button>

                <div class="post-meta">
                    <a href="/">..</a>

                    <p>
                        <time datetime="2026-01-22 00:00:00 &#43;0000 UTC">
                            2026-01-22
                        </time>
                    </p>
                </div>

<article>
    <h1>Detecting drum hits</h1>

    

    <p>The building blocks of drumming are rudiments much like scales are to any melodic instrument. A simple but clean single stroke roll can make you sound like a pro.</p>
<p>I normally practice with a metronome but you can get more sophisticated. There are apps that provide visual feedback for every hit (&ldquo;am i lagging, rushing or on the beat?&rdquo;) so you can adjust accordingly while practicing. I decided to build my own.</p>
<p><strong>Goal: Extract hit times and amplitudes from a drum recording.</strong></p>
<p>How accurate are conventional methods? The idea is to do my own classification (is it a ghost note, accent note, etc.) without AI and see how it performs. I&rsquo;ll add more sophistication in v1.</p>
<p>For now, the script will analyze a file. The use case requires real-time analysis but it&rsquo;s unnecessary at the moment. Here is the <a href="https://github.com/camachom/drum-dynamics">github repo</a> and a simple skeleton:</p>
<h3 id="preprocessing-audio">Preprocessing audio:</h3>
<ol>
<li>load_audio - get samples into <code>numpy</code> array</li>
<li>compute_envelope - smooth the signal</li>
</ol>
<h3 id="hit-detection">Hit detection:</h3>
<ol start="3">
<li>detect_onsets - find where hits occur</li>
<li>measure_hits - get amplitude at each hit</li>
</ol>
<h3 id="analysis">Analysis:</h3>
<ol start="5">
<li>classify_dynamics - classify each hit as either ghost, normal or accent</li>
</ol>
<p>After some trial and error, the script works okay. Here are the samples I was testing with. They&rsquo;re not ideal but I needed something to make sure the basics work. Even without listening to the sample, the charts below aligns with the wave:</p>
<p><a href="https://freesound.org/people/George_Papargyris/sounds/837177/">https://freesound.org/people/George_Papargyris/sounds/837177/</a>
<img src="/files/normal.png" alt="normal drum loop"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Classified dynamics:
</span></span><span style="display:flex;"><span>  0.000s: 1.0000 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0.464s: 0.9101 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0.952s: 1.0000 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  1.463s: 0.8162 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span></code></pre></div><p><a href="https://freesound.org/people/Stereo%20Surgeon/sounds/266093/">https://freesound.org/people/Stereo%20Surgeon/sounds/266093/</a>
<img src="/files/variant.png" alt="variant drum loop"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>Classified dynamics:
</span></span><span style="display:flex;"><span>  0.523s: 1.0000 <span style="color:#f92672">(</span>accent<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  0.896s: 0.6536 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  1.216s: 0.7281 <span style="color:#f92672">(</span>accent<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  1.525s: 0.6003 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  1.845s: 0.4840 <span style="color:#f92672">(</span>normal<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  2.144s: 0.4746 <span style="color:#f92672">(</span>ghost<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>  2.464s: 0.4559 <span style="color:#f92672">(</span>ghost<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>First, let&rsquo;s define an <code>envelope</code>. Raw audio signals are jagged&ndash;falling and raising chaotically since they&rsquo;re recorded at specific intervals (like 44.1 kHz). The goal is to compress subsets of samples into a single value to generate a smooth, estimated curve. Hits will be much easier to detect without so much noise (pun intended). Here is the general idea (although not an actual plot of an envelope):</p>
<p><img src="/files/wave.png" alt="Wave plot showing raw audio signal"></p>
<p>The rectangles are individual samples and the blue curve is what the envelope is trying to achieve. I computed the envelope using <a href="https://en.wikipedia.org/wiki/Root_mean_square">RMS windowing</a> as suggested by Claude:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(samples) <span style="color:#f92672">-</span> window_size, window_size):
</span></span><span style="display:flex;"><span>        window <span style="color:#f92672">=</span> samples[i:i <span style="color:#f92672">+</span> window_size]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        index <span style="color:#f92672">=</span> i <span style="color:#f92672">//</span> window_size
</span></span><span style="display:flex;"><span>        envelope[index] <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>sqrt(np<span style="color:#f92672">.</span>mean(window<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>))
</span></span></code></pre></div><p>It&rsquo;s important to remember that loudness in this case is measured as displacement from 0. An amplitude of -65536 is just as loud as 65536, so squaring is perfectly safe.</p>
<p>In order to detect a <code>hit</code>, I defined a threshold using our envelope (not the raw samples):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>threshold <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>mean(envelope) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.2</span>
</span></span></code></pre></div><p>How did I get to <code>1.2</code>? A <code>hit</code> has to meaningfully deviate from the rest of the curve, but by how much? It&rsquo;s unclear and there isn&rsquo;t a single number that works well for all recordings. The script requires manual tuning based on the input, which limits its generalizability.</p>
<p>The same issue happens when classifying dynamics:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">calculate_dynamic</span>(amplitude: float, ghost_percentile: float, accent_percentile: float) <span style="color:#f92672">-&gt;</span> str:
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ghost_percentile = 20th percentile</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> amplitude <span style="color:#f92672">&lt;=</span> ghost_percentile:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;ghost&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># accent_percentile = 80th percentile</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">elif</span> amplitude <span style="color:#f92672">&gt;=</span> accent_percentile:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;accent&#39;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#39;normal&#39;</span>
</span></span></code></pre></div><p>Those numbers are arbitrary and simply seemed to work well.</p>
<p>It&rsquo;s a good start but far from being useful. I&rsquo;m curious how AI will improve this script.</p>

</article>

            </div>
        </main>
    </body></html>
