<!DOCTYPE html>
<html lang="en"><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
   <meta name="description" content="Like a lot of system design exercises, most engineers don‚Äôt actually build rate limiters at work. Most companies rely on off-the-shelf solutions they‚Äôre already using‚ÄîCloudflare, NGINX, etc. Still, rate limiting is a foundational concept for web developers and a classic system design problem.
The ByteByteGo write-up is helpful, but I don&rsquo;t retain much by just reading. Instead, after getting comfortable with the high-level ideas, I used Claude to build a toy rate limiter.">  

  <title>
    
      System design: rate limiter
    
  </title>


  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
  
  
  
  <link rel="stylesheet" href="//localhost:1313/css/main.56ee6a3d61c97ff4b5a6529d4903f39644e65d9c9e6d51d6f39b66966c0c81a07dcc63c7ba42eab8864c74640b971a24645f2d93243eaaacfdc5a8b496c976f7.css" integrity="sha512-Vu5qPWHJf/S1plKdSQPzlkTmXZyebVHW85tmlmwMgaB9zGPHukLquIZMdGQLlxokZF8tkyQ&#43;qqz9xai0lsl29w==" />
  
</head>

    <script defer src="/js/theme-toggle.min.js"></script>
    <body a="auto">
        <main class="page-content" aria-label="Content">
            <div class="w">
                <button
  id="theme-toggle"
  aria-label="Toggle theme"
  style="
    all: unset;
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 999;
    font-size: 1.2rem;
    line-height: 1;
    padding: 0;
    margin: 0;
    cursor: pointer;
  "
>
  üåì
</button>

                <div class="post-meta">
                    <a href="/">..</a>

                    <p>
                        <time datetime="2026-01-12 00:00:00 &#43;0000 UTC">
                            2026-01-12
                        </time>
                    </p>
                </div>

<article>
    <h1>System design: rate limiter</h1>

    

    <p>Like a lot of system design exercises, most engineers don‚Äôt actually build rate limiters at work. Most companies rely on off-the-shelf solutions they‚Äôre already using‚ÄîCloudflare, NGINX, etc. Still, rate limiting is a foundational concept for web developers and a classic system design problem.</p>
<p>The <a href="https://bytebytego.com/courses/system-design-interview/design-a-rate-limiter">ByteByteGo write-up</a> is helpful, but I don&rsquo;t retain much by just reading. Instead, after getting comfortable with the high-level ideas, I used Claude to build a toy rate limiter.</p>
<p>It was surprisingly satisfying to run <code>curl</code> locally and watch the headers change as requests were consumed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>me@MacBookPro ~&gt; curl -i localhost:3000/ping
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>x-ratelimit-limit: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>x-ratelimit-remaining: <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>x-ratelimit-reset: <span style="color:#ae81ff">1768250604</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;pong&#34;</span>,<span style="color:#e6db74">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;2026-01-12T20:43:18Z&#34;</span><span style="color:#f92672">}</span>‚èé
</span></span><span style="display:flex;"><span>me@MacBookPro ~&gt; curl -i localhost:3000/ping
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>x-ratelimit-limit: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>x-ratelimit-remaining: <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>x-ratelimit-reset: <span style="color:#ae81ff">1768250610</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;message&#34;</span>:<span style="color:#e6db74">&#34;pong&#34;</span>,<span style="color:#e6db74">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;2026-01-12T20:43:20Z&#34;</span><span style="color:#f92672">}</span>‚èé
</span></span></code></pre></div><p>And finally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>me@MacBookPro ~&gt; curl -i localhost:3000/ping
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>x-ratelimit-limit: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>x-ratelimit-remaining: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>x-ratelimit-reset: <span style="color:#ae81ff">1768250721</span>
</span></span><span style="display:flex;"><span>retry-after: <span style="color:#ae81ff">55</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;error&#34;</span>:<span style="color:#e6db74">&#34;Rate limit exceeded&#34;</span><span style="color:#f92672">}</span>‚èé
</span></span></code></pre></div><p>I implemented the rate limiter as a Rails middleware using an in-memory <a href="https://en.wikipedia.org/wiki/Token_bucket">token bucket</a>. At its core, it‚Äôs just a hash with some bookkeeping:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ruby" data-lang="ruby"><span style="display:flex;"><span><span style="color:#66d9ef">module</span> RateLimiter
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">module</span> Stores
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Memory</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">Base</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">initialize</span>
</span></span><span style="display:flex;"><span>        @data <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        @mutex <span style="color:#f92672">=</span> <span style="color:#66d9ef">Mutex</span><span style="color:#f92672">.</span>new
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get</span>(key)
</span></span><span style="display:flex;"><span>        @mutex<span style="color:#f92672">.</span>synchronize <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>          entry <span style="color:#f92672">=</span> @data<span style="color:#f92672">[</span>key<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span> <span style="color:#66d9ef">unless</span> entry
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> entry<span style="color:#f92672">[</span><span style="color:#e6db74">:expires_at</span><span style="color:#f92672">]</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">Time</span><span style="color:#f92672">.</span>now <span style="color:#f92672">&gt;</span> entry<span style="color:#f92672">[</span><span style="color:#e6db74">:expires_at</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>            @data<span style="color:#f92672">.</span>delete(key)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>          entry<span style="color:#f92672">[</span><span style="color:#e6db74">:value</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">end</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">...</span>
</span></span></code></pre></div><p>The mutex caught me off guard. Multithreading is easy to overlook in an exercise like this.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>me@MacBookPro ~/R/rate-limiter-tester&gt; rails server -p 3000
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Booting Puma
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Rails 8.1.1 application starting in development
</span></span><span style="display:flex;"><span><span style="color:#f92672">=</span>&gt; Run <span style="color:#e6db74">`</span>bin/rails server --help<span style="color:#e6db74">`</span> <span style="color:#66d9ef">for</span> more startup options
</span></span><span style="display:flex;"><span>Puma starting in single mode...
</span></span><span style="display:flex;"><span>* Puma version: 7.1.0 <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Neon Witch&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>* Ruby version: ruby 4.0.0 <span style="color:#f92672">(</span>2025-12-25 revision 553f1675f3<span style="color:#f92672">)</span> +PRISM <span style="color:#f92672">[</span>arm64-darwin25<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>*  Min threads: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>*  Max threads: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>*  Environment: development
</span></span><span style="display:flex;"><span>*          PID: <span style="color:#ae81ff">60042</span>
</span></span><span style="display:flex;"><span>* Listening on http://127.0.0.1:3000
</span></span><span style="display:flex;"><span>* Listening on http://<span style="color:#f92672">[</span>::1<span style="color:#f92672">]</span>:3000
</span></span><span style="display:flex;"><span>Use Ctrl-C to stop
</span></span></code></pre></div><p>Even in development, Puma is running multiple threads. Without a <code>Mutex</code>, it‚Äôs easy to introduce subtle race conditions and inconsistent token counts under load.</p>
<p>None of this is groundbreaking. You <em>can</em> absorb it by carefully reading an article. But implementing a toy version forces the details to click. When it‚Äôs reasonable, I try to build small, working versions of the systems I‚Äôm learning‚Äîit‚Äôs consistently the fastest way I‚Äôve found to make the details stick.</p>

</article>

            </div>
        </main>
    </body></html>
